@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model B2B.Models.KNA1

<style>
    div.dt-processing > div:last-child {
        display: none;
    }
</style>

<input type="hidden" id="kna1-sortl" name="kna1-sortl" value="@Model.SORTL" />

<div id="jCrumbs" class="breadCrumb module">
    <ul>
        <li>
            <a href="#">
                <i class="glyphicon glyphicon-home"></i>
            </a>
        </li>
        <li style="background: none;">
            <span style="width: 50px;"><a href="#" style="width: 83px;">Satış</a></span>
            <div class="chevronOverlay" style="display: block;"></div>
        </li>
        <li>
            Stok Listesi
        </li>
    </ul>
</div>

<div class="row">
    <a id="btn-execute" class="btn btn-default btn-etiket float-left heading" style="position: relative; left: 13px;font-size:12px;">
        <i class="fa fa-check"></i>
        Yürüt
    </a>

    <div class="col-sm-12 col-md-12" style="margin-top:30px">
        <h3 class="heading">
        </h3>
    </div>

    <div class="col-sm-12 col-md-12">
        <div class="col-sm-10">
            <form>
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Ana Grup :</label>
                    <div class="col-sm-3">
                        <select id="drpMvgr3" class="form-control js-example-basic-single">
                            <option value="">Seçiniz</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Koleksiyon :</label>
                    <div class="col-sm-3">
                        <select id="drpMvgr2" class="form-control js-example-basic-single">
                            <option value="">Seçiniz</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label" style="margin-bottom:18px">Ürün Tipi :</label>
                    <div class="col-sm-3">
                        <select id="drpMvgr4" class="form-control js-example-basic-single">
                            <option value="">Seçiniz</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>

        <div id="div-message" class="col-sm-2" style="display:none">
            <div class='alert alert-danger alert-dismissable'>
                Ana Grup, Koleksiyon veya Ürün Tipi alanlarından birinin seçilmesi zorunludur.
            </div>
        </div>
    </div>

    <div class="col-sm-12 col-md-12 heading" style="margin-top:135px">
    </div>

    <div class="col-sm-12 col-md-12">
        <table class="table table-striped table-bordered dTableR" id="tblStock">
        </table>
    </div>
</div>

@section Scripts{
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('.js-example-basic-single').select2({
                allowClear: true
            });

            const optionSelection = document.createElement('option');
            optionSelection.value = '';
            optionSelection.textContent = 'Seçiniz';

            $.ajax({
                  url: '@Url.Action("GetMaterialGrub", "Stock")',
                  type: 'POST',
                  contentType: 'application/json',
                success: function (response) {
                    const drpMvgr3 = document.getElementById('drpMvgr3');
                    $.each(response.data.tvm3ts, function (index, mvm3t) {
                        const optionElement = document.createElement('option');

                        optionElement.value = mvm3t.MVGR3;
                        optionElement.textContent = mvm3t.BEZEI;

                        drpMvgr3.appendChild(optionElement);
                    });

                    const drpMvgr2 = document.getElementById('drpMvgr2');
                    $.each(response.data.tvm2ts, function (index, mvm2t) {
                        const optionElement = document.createElement('option');

                          optionElement.value = mvm2t.MVGR2;
                          optionElement.textContent = mvm2t.BEZEI;

                          drpMvgr2.appendChild(optionElement);
                      });

                    const drpMvgr4 = document.getElementById('drpMvgr4');
                    $.each(response.data.tvm4ts, function (index, mvm4t) {
                        const optionElement = document.createElement('option');

                        optionElement.value = mvm4t.MVGR4;
                        optionElement.textContent = mvm4t.BEZEI;

                        drpMvgr4.appendChild(optionElement);
                      });
                  },
                  error: function () {
                    alert('Error: ' + error);
                  }
            });

            var table = $('#tblStock').DataTable({
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.11.3/i18n/tr.json",
                   'processing': '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>'
                },
                processing: true, // for show progress bar,
                retrieve: true,
               /* buttons: [ 'excel'],*/
                columns: [
                    { "title": "Malzeme","data": "MATNR"  },
                    { "title": "Malzeme Kısa Metni", "data": "MAKTX" },
                    { "title": "Malzeme Uzun Metni","data": "LONG_MAKTX" },
                    { "title": "Koleksiyon","data": "BEZEI2" },
                    { "title": "Ana Grup","data": "BEZEI3" },
                    { "title":"Ürün Tipi","data": "BEZEI4" },
                    { "title": "Ürün Biçimi","data": "BEZEI5" },
                    { "title": "Ankara Stok", "data": "CMPT_ANPD" },
                    { "title": "Mersin Stok", "data": "CMPT_MRSN" },
                    { "title": "İstanbul Stok", "data": "CMPT_A049" },
                    { "title": "Fabrika Stok", "data": "CMPT_SEVK" }
                ],
                columnDefs: [
                    {
                        targets: '_all',
                        className: 'dt-left'
                    }
                ]
            });

            setTimeout(function () {
                if ($("#kna1-sortl").val() == 'BAYI') {
                    table.column(7).visible(false);
                    table.column(8).visible(false);
                    table.column(9).visible(false);
                }
            }, 200);

            $("#btn-execute").click(function () {
                document.getElementById("div-message").style.display = "none";

                var mvgr2 = $('#drpMvgr2').val();
                var mvgr3 = $('#drpMvgr3').val();
                var mvgr4 = $('#drpMvgr4').val();

                if (mvgr2 == "" && mvgr3 == "" && mvgr4 == "") {
                    document.getElementById("div-message").style.display = "block";
                    return;
                }

                table.ajax.url('/Stock/GetData?sortl=' + $("#kna1-sortl").val() + '&mvgr2=' + mvgr2 +'&mvgr3=' + mvgr3 + '&mvgr4=' + mvgr4).load();
            });
        });
    </script>
}


